# Aircraft Waypoints - User Manual

AI 항공기가 사용자 정의 웨이포인트 경로를 따라 비행하게 하는 모드입니다.
시네마틱 영상 촬영, 편대비행 연출 등에 활용할 수 있습니다.

---

## 설치

`AircraftWaypoints.dll`을 아래 경로에 복사:
```
Nuclear Option\BepInEx\plugins\AircraftWaypoints.dll
```

---

## 기본 사용법

### 1단계: 미션 에디터에서 항공기 배치
미션 에디터에서 AI 항공기를 원하는 만큼 배치합니다.

### 2단계: UI 열기
**F5** 키를 누르면 웨이포인트 UI가 열립니다. (설정에서 변경 가능)

### 3단계: 경로 만들기
1. **Routes** 탭으로 이동
2. **+ New Route** 클릭
3. 경로 이름 입력 (예: "Main Route")
4. 비행 모드 선택 (Loop / OneShot / PingPong)
5. 웨이포인트 추가:
   - **Click Map**: 맵을 클릭해서 배치 (지면 위 설정된 고도에 생성)
   - **At Camera**: 현재 카메라 위치에 배치

### 4단계: 항공기에 경로 할당
1. **Aircraft** 탭으로 이동
2. 리스트에서 항공기 클릭 (선택됨 표시)
3. **Routes** 탭에서 할당할 경로 선택
4. 다시 **Aircraft** 탭으로 돌아가서 **Assign** 버튼 클릭

### 5단계: 미션 시작
미션 에디터에서 게임을 시작하면 AI가 자동으로 웨이포인트를 따라 비행합니다.

---

## 화면에 표시되는 것들

| 표시 | 의미 |
|------|------|
| 노란 사각형 + WP1, WP2... | 웨이포인트 위치 |
| 노란 선 (WP 사이) | 경로 연결선 + 구간 거리 |
| 초록 선 (마지막→첫번째) | Loop 모드 복귀 경로 |
| 주황 수직선 + 고도 라벨 | 해수면~웨이포인트 고도 |
| 시안 사각형 + >> 이름 << | 현재 선택된 항공기 |
| 초록 점 + 이름 | 경로가 할당된 항공기 |
| [!] 또는 [!!] | 급격한 선회 경고 (90도/120도 초과) |

### 웨이포인트 배치 모드 (Click Map)
맵 클릭 시 지면에서 웨이포인트 고도까지 **노란 수직선**이 표시됩니다.
이것으로 실제 비행 고도를 미리 확인할 수 있습니다.

---

## 비행 모드

| 모드 | 설명 |
|------|------|
| **Loop** | 마지막 WP 도달 후 첫 WP로 되돌아가서 무한 반복 |
| **OneShot** | 마지막 WP 도달 후 정지 (일반 AI로 복귀) |
| **PingPong** | 마지막 WP 도달 후 역순으로 되돌아감, 반복 |

---

## 편대비행 (Formation Flying)

같은 경로를 여러 항공기에 할당하되, **Formation Offset**을 다르게 설정합니다.

### 오프셋 좌표계
경로 **진행 방향** 기준 상대 좌표입니다:
- **R (Right)**: 양수 = 오른쪽, 음수 = 왼쪽
- **U (Up)**: 양수 = 위, 음수 = 아래
- **F (Forward)**: 양수 = 앞, 음수 = 뒤

선회 시에도 경로 방향에 맞춰 오프셋이 자동 회전하므로 편대 형상이 유지됩니다.

### 프리셋 버튼
| 프리셋 | R | U | F | 용도 |
|--------|-----|-----|------|------|
| Leader | 0 | 0 | 0 | 선두기 (기본) |
| R Wing | 200 | 0 | -100 | 오른쪽 윙맨 |
| L Wing | -200 | 0 | -100 | 왼쪽 윙맨 |
| Trail | 0 | 0 | -200 | 후미 추종 |

### 예시: V자 편대 (4기)
1. Routes 탭에서 경로 1개 생성
2. Aircraft 탭에서:
   - 1번기 선택 → Leader 프리셋 → Assign
   - 2번기 선택 → R Wing 프리셋 → Assign
   - 3번기 선택 → L Wing 프리셋 → Assign
   - 4번기 선택 → Trail 프리셋 → Assign

### 예시: 에셜론 우측 (3기)
1. 같은 경로에:
   - 1번기: R:0 U:0 F:0
   - 2번기: R:200 U:0 F:-150
   - 3번기: R:400 U:0 F:-300

### 오프셋 변경 (이미 할당된 항공기)
Aircraft 탭에서 항공기 선택 → R/U/F 값 수정 → **Update Offset** 클릭
게임플레이 중에도 실시간으로 변경 가능합니다.

---

## 여러 항공기에 각각 다른 경로 할당하기

편대비행이 아닌 개별 경로도 가능합니다:
1. Routes 탭에서 경로를 여러 개 생성 (Route 1, Route 2...)
2. Aircraft 탭에서 항공기 A 선택 → Route 1 선택 → Assign
3. Aircraft 탭에서 항공기 B 선택 → Route 2 선택 → Assign

한 화면에서 모두 처리되며, 각 항공기가 서로 다른 경로를 독립적으로 비행합니다.

---

## 저장 / 로드

### 저장
1. **Save/Load** 탭으로 이동
2. 파일 이름 입력
3. **Save** 클릭

경로, 항공기 할당, 편대 오프셋이 모두 저장됩니다.

### 로드
1. Save/Load 탭에서 파일 리스트 확인
2. **Load** 클릭

저장 위치: `BepInEx\plugins\WaypointData\*.json`

---

## 게임플레이 중 조작

미션 시작 후에도 F5로 UI를 열 수 있습니다:
- **Pause / Resume**: 웨이포인트 비행 일시정지/재개
- **Reset WP**: 첫 번째 웨이포인트부터 다시 시작

---

## 웨이포인트 배치 팁

### 고도 설정
- **Alt** 필드에 고도(미터) 입력 후 Click Map
- 배치 시 지면→고도 수직선으로 미리 확인 가능
- 최소 50m ~ 최대 5000m

### 속도 제어
- **Spd** 필드에 속도(m/s) 입력 (0 = 자동, 항공기 최대속도)
- 예: 전투기 100m/s ≈ 360km/h (순항), 200m/s ≈ 720km/h (고속)

### 부드러운 비행을 위한 팁
- 급격한 선회각 피하기: WP 사이 각도가 90도 이상이면 [!] 경고 표시됨
- WP 간격을 넓게 유지 (최소 2~3km 이상 권장)
- Config에서 **ArrivalRadius** 값을 늘리면 더 넓은 곡선으로 선회
- Config에서 **TurnSmoothness**를 낮추면 (0.2) 더 부드러운 시네마틱 선회

---

## Config 설정

`BepInEx\config\com.noms.aircraftwaypoints.cfg`:

| 설정 | 기본값 | 설명 |
|------|--------|------|
| ToggleKey | F5 | UI 토글 키 |
| ArrivalRadius | 500 | WP 도달 판정 거리(m). 클수록 일찍 다음 WP로 전환 |
| TurnSmoothness | 0.5 | AI 선회 적극성 (0.2=부드러운 시네마틱, 1.0=급선회) |

---

## 알려진 제한사항

- 미션 에디터에서만 경로 설정 가능 (게임플레이 중 새 WP 추가는 불가)
- AI는 기본적으로 지형 회피가 활성화되어 있어 산이나 건물 근처에서는 경로를 약간 벗어날 수 있음
- 연료 부족으로 인한 착륙은 비활성화됨 (시네마틱용)
- 멀티플레이어에서는 호스트만 AI를 제어할 수 있음
